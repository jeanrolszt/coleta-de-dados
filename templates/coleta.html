{% extends "base.html" %}
{% block title %} Home {% endblock %}

{% block content %}
<div class="container mt-5  align-items-center">
    <div class="row justify-content-center ">
      <div class="col-md-10" style="margin-top:-55px">
        <div class="card">
          <div class="card-header" style="background-color:#519C64;color:#DCF5E4">
            <h4 class="text-center">MDB - Base Cadastral Para Votações</h4>
            <p class="mb-0 text-center">Confirme ou atualize seus dados. Assim, na hora da votação conseguiremos te localizar mais facilmente.</p>
          </div>
          <div class="card-body">
              <div class="alert alert-danger show" style="display: none;" role="alert">
              </div>
            <form class="login-form" name="registrar" method="post" role="form" action="/registrar" autocomplete="off" onsubmit = "return validateForm()">
            <div class="login-form__logo-container">
                <img class="login-form__logo" src="../static/img/mdbLogo.png" alt="Logo">
            </div>
            <div class="login-form__content">
                <input class="login-form__input" id="cpf" type="text" maxlength="14" name="cpf" required placeholder="CPF">
                <input class="login-form__input" type="text" name="nomeCompleto" id="nome" required placeholder="Nome">
               <input class="login-form__input" id="telefone" type="text"  name="telefone" required placeholder="Telefone">
               <input class="login-form__input" id="email" type="email" name="email" required placeholder="E-mail">
                <input id="ischecked" type="checkbox"  required>
                <label style="font-size:15px">Confirmo que esses dados são meus.</label>


               <button class="login-form__button" style="background-color:#519C64" id="buttonReg" type="submit">Registrar</button>

            </div>
        </form>

      <div class="alert alert-danger text-center" style="display:none" id="alertaCpf">
          Esse CPF não foi encontrado em nossa base. Por favor, contate o suporte.
      </div>

      <div class="alert alert-success text-center"  >
          Precisa de ajuda? Fale conosco <a href="https://wa.me/5561998142978" target="_blank">
          <svg style="margin-top:-5px;color:green" xmlns="http://www.w3.org/2000/svg" width="28" height="38" fill="currentColor" class="bi bi-whatsapp" viewBox="0 0 16 16">
  <path d="M13.601 2.326A7.854 7.854 0 0 0 7.994 0C3.627 0 .068 3.558.064 7.926c0 1.399.366 2.76 1.057 3.965L0 16l4.204-1.102a7.933 7.933 0 0 0 3.79.965h.004c4.368 0 7.926-3.558 7.93-7.93A7.898 7.898 0 0 0 13.6 2.326zM7.994 14.521a6.573 6.573 0 0 1-3.356-.92l-.24-.144-2.494.654.666-2.433-.156-.251a6.56 6.56 0 0 1-1.007-3.505c0-3.626 2.957-6.584 6.591-6.584a6.56 6.56 0 0 1 4.66 1.931 6.557 6.557 0 0 1 1.928 4.66c-.004 3.639-2.961 6.592-6.592 6.592zm3.615-4.934c-.197-.099-1.17-.578-1.353-.646-.182-.065-.315-.099-.445.099-.133.197-.513.646-.627.775-.114.133-.232.148-.43.05-.197-.1-.836-.308-1.592-.985-.59-.525-.985-1.175-1.103-1.372-.114-.198-.011-.304.088-.403.087-.088.197-.232.296-.346.1-.114.133-.198.198-.33.065-.134.034-.248-.015-.347-.05-.099-.445-1.076-.612-1.47-.16-.389-.323-.335-.445-.34-.114-.007-.247-.007-.38-.007a.729.729 0 0 0-.529.247c-.182.198-.691.677-.691 1.654 0 .977.71 1.916.81 2.049.098.133 1.394 2.132 3.383 2.992.47.205.84.326 1.129.418.475.152.904.129 1.246.08.38-.058 1.171-.48 1.338-.943.164-.464.164-.86.114-.943-.049-.084-.182-.133-.38-.232z"/>
</svg>
      </a>
      </div>

          </div>
        </div>
      </div>
    </div>
  </div>

<script>


function readBody(xmlHttp) {
    return xmlHttp.response;
}

function httpGetAsync(theUrl)
{
    var xmlHttp = new XMLHttpRequest();
    xmlHttp.onreadystatechange = function() {

        if (xmlHttp.readyState == 4 && xmlHttp.status == 200)
           var serviceResponse = xmlHttp.responseText;

           if (typeof serviceResponse != "undefined"){
                console.log("entrou")
                var jsonResponse = JSON.parse(serviceResponse);
                var nome = jsonResponse.nome;
                var cpfResponse = jsonResponse.cpfResponse;
                var email = jsonResponse.email;
                var telefone = jsonResponse.telefone;
                if (typeof nome != "undefined") document.getElementById("nome").value = nome
                if (typeof email != "undefined") document.getElementById("email").value = email
                if (typeof telefone != "undefined") document.getElementById("telefone").value = telefone
                document.getElementById( 'alertaCpf' ).style.display = 'none';
                document.getElementById("buttonReg").disabled = false;
           }

           if (typeof nome == "undefined"){
              document.getElementById("nome").value = ""
              document.getElementById("email").value = ""
              document.getElementById("telefone").value = ""
              document.getElementById( 'alertaCpf' ).style.display = 'block';
              document.getElementById("buttonReg").disabled = true;
           }

    }
    xmlHttp.open("GET", theUrl, true);
    xmlHttp.send();
}

let cpf = document.getElementById("cpf");

cpf.onblur = function(){
   console.log("blur", "saiu do input" , this);
   httpGetAsync("http://192.168.0.10:8444/pessoa/" + cpf.value); //MUDAR PARA BASE URL
}



</script>

  <script>
    window.addEventListener('DOMContentLoaded', function() {
      var cpfInput = document.getElementById('cpf');
      cpfInput.addEventListener('input', function() {
        var cpf = cpfInput.value;
        cpf = cpf.replace(/\D/g, ''); // Remove todos os caracteres não numéricos
        cpf = cpf.replace(/(\d{3})(\d)/, '$1.$2'); // Adiciona o primeiro ponto
        cpf = cpf.replace(/(\d{3})(\d)/, '$1.$2'); // Adiciona o segundo ponto
        cpf = cpf.replace(/(\d{3})(\d{1,2})$/, '$1-$2'); // Adiciona o traço
        
        cpfInput.value = cpf;
      });

      var nomeInput = document.getElementById('nome');
      nomeInput.addEventListener('input', function() {
        var nome = nomeInput.value;
        nome = nome.replace(/[^a-zA-Z\u00C0-\u00FF\s]/g, ''); // Remove caracteres não permitidos
        
        //nomeInput.value = nome.toUpperCase();
      });

      var telefoneInput = document.getElementById('telefone');
      telefoneInput.addEventListener('input', function() {
        var telefone = telefoneInput.value;
        telefone = telefone.replace(/\D/g, ''); // Remove todos os caracteres não numéricos
        telefone = telefone.replace(/(\d{0})(\d)/, '$1($2'); // Adiciona o primeiro parenteses
        telefone = telefone.replace(/(\d{2})(\d)/, '$1)$2'); // Adiciona o segundo parenteses
        telefone = telefone.replace(/(\d{5})(\d)/, '$1-$2'); // Adiciona o traço
        
        telefoneInput.value = telefone;
      });
    });

    function validateForm() {
        var nomeCompleto = document.forms["registrar"]["nomeCompleto"].value;
        var cpf = document.forms["registrar"]["cpf"].value;
        var telefone = document.forms["registrar"]["telefone"].value;
        var email = document.forms["registrar"]["email"].value;

        if(nomeCompleto == null || nomeCompleto == "") {
            document.getElementsByClassName( "alert" )[0].style.display = "block";
            document.getElementsByClassName( "alert" )[0].innerHTML = "O campo Nome Completo é obrigatório";
            return false;
        } else if(cpf.length < 14) {
            document.getElementsByClassName( "alert" )[0].style.display = "block";
            document.getElementsByClassName( "alert" )[0].innerHTML = "O campo CPF está incorreto";
            return false;
        } else if(telefone.length < 14) {
            document.getElementsByClassName( "alert" )[0].style.display = "block";
            document.getElementsByClassName( "alert" )[0].innerHTML = "O campo Telefone está incorreto";
            return false;
        } else if(email == null || email == "") {
            document.getElementsByClassName( "alert" )[0].style.display = "block";
            document.getElementsByClassName( "alert" )[0].innerHTML = "O campo Email é obrigatório";
            return false;
        } else {
            document.getElementsByClassName( "alert" )[0].style.visibility = "block";
            document.getElementsByClassName( "alert" )[0].innerHTML = "";
            return true;
        }
            
    }
  </script>
{% endblock %}
